<div class="orders-page p-6">
	<h1 class="text-2xl font-semibold mb-4">Order Management</h1>

	<div class="grid grid-cols-4 gap-4 mb-6">
		<div class="card p-4 bg-white rounded shadow">
			<div class="text-sm text-gray-600">Total Orders</div>
			<div class="text-2xl font-bold">{{ counts.total }}</div>
		</div>
		<div class="card p-4 bg-white rounded shadow">
			<div class="text-sm text-gray-600">Pending</div>
			<div class="text-2xl font-bold">{{ counts.pending }}</div>
		</div>
		<div class="card p-4 bg-white rounded shadow">
			<div class="text-sm text-gray-600">Confirmed</div>
			<div class="text-2xl font-bold">{{ counts.confirmed }}</div>
		</div>
		<div class="card p-4 bg-white rounded shadow">
			<div class="text-sm text-gray-600">Shipped</div>
			<div class="text-2xl font-bold">{{ counts.shipped }}</div>
		</div>
	</div>

	<div class="filters bg-white p-4 rounded shadow mb-4 flex gap-3 items-center">
		<select [(ngModel)]="filterStatus" (change)="searchOrders()" class="border p-2 rounded">
			<option [ngValue]="null">All Status</option>
			<option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
		</select>

		<select (change)="searchOrders()" class="border p-2 rounded">
			<option value="latest">Latest First</option>
			<option value="oldest">Oldest First</option>
		</select>

		<input type="text" [(ngModel)]="filterQuery" placeholder="Search by order ID or customer name..." class="flex-1 border p-2 rounded" />
		<button class="bg-blue-600 text-white px-4 py-2 rounded" (click)="searchOrders()">Search</button>
	</div>

	<div class="bg-white rounded shadow overflow-x-auto">
		<table class="w-full text-left">
			<thead>
				<tr class="bg-gray-50">
					<th class="p-3">Order ID</th>
					<th class="p-3">Customer</th>
					<th class="p-3">Date</th>
					<th class="p-3">Total</th>
					<th class="p-3">Status</th>
					<th class="p-3">Update Status</th>
					<th class="p-3">Actions</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let o of orders" class="border-t">
					<td class="p-3">#{{ o.orderNumber || o._id }}</td>
					<td class="p-3">{{ o.customerName || (o.fkUserId || '') }}</td>
					<td class="p-3">{{ o.createdOn ? (o.createdOn | date:'mediumDate') : '-' }}</td>
					<td class="p-3">{{ o.totalPrice ? ('₹' + (o.totalPrice | number:'1.2-2')) : '-' }}</td>
					<td class="p-3"><span class="status-badge">{{ o.status || '-' }}</span></td>
					<td class="p-3">
						<select [ngModel]="o.status" (ngModelChange)="changeStatus(o, $event)" class="border p-1 rounded">
							<option *ngFor="let s of statusOptions" [value]="s">{{ s }}</option>
						</select>
					</td>
					<td class="p-3 flex gap-2">
						<button class="px-3 py-1 bg-blue-600 text-white rounded" (click)="viewOrder(o._id)">View</button>
						<button class="px-3 py-1 bg-red-500 text-white rounded" (click)="removeOrder(o)">Delete</button>
					</td>
				</tr>
				<tr *ngIf="orders.length === 0">
					<td class="p-6" colspan="7">No orders found.</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- Modal: Order Details -->
	<div *ngIf="selectedOrder" class="modal fixed inset-0 flex items-center justify-center z-50">
		<div class="modal-backdrop absolute inset-0 bg-black opacity-50" (click)="closeModal()"></div>
		<div class="modal-content bg-white rounded shadow-lg z-10 max-w-lg w-full">
			<div class="p-4 border-b flex justify-between items-center">
				<h3 class="text-lg font-semibold">Order Details</h3>
				<button class="text-gray-600" (click)="closeModal()">✕</button>
			</div>
			<div class="p-4">
				<div class="grid grid-cols-2 gap-3">
					<div><strong>Order ID:</strong> #{{ selectedOrder.orderNumber }}</div>
					<div class="text-right"><strong>{{ selectedOrder.status }}</strong></div>
					<div><strong>Customer:</strong> {{ selectedOrder.customerName}}</div>
					<div class="text-right"><strong>Date:</strong> {{ selectedOrder.createdOn | date:'longDate' }}</div>
				</div>

				<div class="mt-4">
					<h4 class="font-semibold">Order Items:</h4>
					<ul class="mt-2">
						<li *ngFor="let it of selectedOrder.items" class="flex justify-between py-2 border-b">
							<span>{{ it.productName }} x{{ it.quantity }}</span>
							<span>{{ it.totalPrice ? ('₹' + (it.totalPrice | number:'1.2-2')) : '-' }}</span>
						</li>
					</ul>
				</div>
			</div>
			<div class="p-4 border-t flex justify-end gap-2">
				<button class="px-4 py-2 bg-gray-200 rounded" (click)="closeModal()">Close</button>
			</div>
		</div>
	</div>
</div>
